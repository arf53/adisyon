<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Admin Paneli - Restoran YÃ¶netimi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h2 class="text-center mb-4 text-primary">Restoran YÃ¶netim Paneli</h2>
    
    <div class="row">
        <div class="col-md-4">
            
            <div class="card shadow mb-4">
                <div class="card-header bg-warning text-dark">
                    <h6 class="m-0">â• Yeni Kategori OluÅŸtur</h6>
                </div>
                <div class="card-body">
                    <label>Kategori AdÄ±:</label>
                    <input type="text" id="kategoriAdi" class="form-control mb-2" placeholder="Ã–rn: Ã‡orbalar">
                    <button onclick="kategoriEkle()" class="btn btn-warning w-100">Kategori Ekle</button>
                </div>
            </div>

            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h6 class="m-0">ğŸ” Yeni ÃœrÃ¼n Ekle</h6>
                </div>
                <div class="card-body">
                    <label>ÃœrÃ¼n AdÄ±:</label>
                    <input type="text" id="urunAdi" class="form-control mb-2" placeholder="Ã–rn: Mercimek Ã‡orbasÄ±">
                    
                    <label>Fiyat (TL):</label>
                    <input type="number" id="urunFiyat" class="form-control mb-2" placeholder="0.00">
                    
                    <label>Kategori SeÃ§:</label>
                    <select id="urunKategori" class="form-select mb-3">
                        <option selected disabled>YÃ¼kleniyor...</option>
                    </select>

                    <button onclick="urunEkle()" class="btn btn-success w-100">ÃœrÃ¼nÃ¼ Kaydet</button>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                    <h5 class="m-0">ğŸ“‹ Mevcut MenÃ¼</h5>
                    <button onclick="sayfayiYenile()" class="btn btn-sm btn-outline-light">Tabloyu Yenile</button>
                </div>
                <div class="card-body">
                    <table class="table table-hover table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ÃœrÃ¼n AdÄ±</th>
                                <th>Fiyat</th>
                                <th>Kategori ID</th>
                            </tr>
                        </thead>
                        <tbody id="urunListesi">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- Ã–NEMLÄ° AYAR: SUNUCU ADRESÄ° ---
    // EÄŸer kendi bilgisayarÄ±nda Ã§alÄ±ÅŸÄ±yorsan: "http://127.0.0.1:8000"
    // EÄŸer PythonAnywhere'de Ã§alÄ±ÅŸÄ±yorsan: "https://ahmt58.pythonanywhere.com"
    // Åimdilik Localhost ayarlÄ± bÄ±rakÄ±yorum:
    const BASE_URL = "http://127.0.0.1:8000"; 

    window.onload = function() {
        sayfayiYenile();
    };

    function sayfayiYenile() {
        kategorileriGetir();
        menuyuGetir();
    }

    // --- 1. KATEGORÄ° Ä°ÅLEMLERÄ° ---
    async function kategorileriGetir() {
        try {
            // Fetch adresinin baÅŸÄ±na BASE_URL ekledik
            const response = await fetch(`${BASE_URL}/categories`);
            
            if (!response.ok) {
                throw new Error("Sunucuya ulaÅŸÄ±lamadÄ± (CORS veya Sunucu KapalÄ±)");
            }

            const kategoriler = await response.json();
            const selectKutu = document.getElementById("urunKategori");
            selectKutu.innerHTML = ""; 

            if(kategoriler.length === 0) {
                selectKutu.innerHTML = "<option disabled selected>Ã–nce Kategori Ekleyin!</option>";
            } else {
                kategoriler.forEach(kat => {
                    selectKutu.innerHTML += `<option value="${kat.id}">${kat.name}</option>`;
                });
            }
        } catch (error) {
            console.error("Hata:", error);
            // Hata mesajÄ±nÄ± ekrana basmÄ±yoruz ki sÃ¼rekli popup Ã§Ä±kmasÄ±n
        }
    }

    async function kategoriEkle() {
        const ad = document.getElementById("kategoriAdi").value;
        if(!ad) { alert("LÃ¼tfen isim girin!"); return; }

        try {
            const response = await fetch(`${BASE_URL}/categories`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: ad })
            });

            if (response.ok) {
                alert("âœ… Kategori eklendi!");
                document.getElementById("kategoriAdi").value = "";
                sayfayiYenile(); 
            } else {
                alert("Hata oluÅŸtu! Kategori eklenemedi.");
            }
        } catch (error) {
            alert("Sunucu hatasÄ±: " + error.message);
        }
    }

    // --- 2. ÃœRÃœN Ä°ÅLEMLERÄ° ---
    async function menuyuGetir() {
        try {
            const response = await fetch(`${BASE_URL}/products`);
            const urunler = await response.json();
            const tablo = document.getElementById("urunListesi");
            tablo.innerHTML = ""; 

            urunler.forEach(urun => {
                tablo.innerHTML += `
                    <tr>
                        <td><span class="badge bg-secondary">${urun.id}</span></td>
                        <td><b>${urun.name}</b></td>
                        <td>${urun.price} â‚º</td>
                        <td>${urun.category_id}</td>
                    </tr>
                `;
            });
        } catch (error) {
            console.error("Hata:", error);
        }
    }

    async function urunEkle() {
        const ad = document.getElementById("urunAdi").value;
        const fiyat = document.getElementById("urunFiyat").value;
        const katId = document.getElementById("urunKategori").value;

        if(!ad || !fiyat || !katId) {
            alert("LÃ¼tfen tÃ¼m alanlarÄ± doldurun ve bir kategori seÃ§in!");
            return;
        }

        const veri = {
            name: ad,
            price: parseFloat(fiyat),
            category_id: parseInt(katId)
        };

        try {
            const response = await fetch(`${BASE_URL}/products`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(veri)
            });

            if (response.ok) {
                alert("âœ… ÃœrÃ¼n baÅŸarÄ±yla eklendi!");
                sayfayiYenile();
                document.getElementById("urunAdi").value = "";
                document.getElementById("urunFiyat").value = "";
            } else {
                alert("Hata oluÅŸtu! Kategori ID'si geÃ§ersiz olabilir.");
            }
        } catch (error) {
            alert("BaÄŸlantÄ± hatasÄ±: " + error.message);
        }
    }
</script>

</body>
</html>