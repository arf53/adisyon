<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Admin Paneli - Restoran Y√∂netimi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5 mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary">Restoran Y√∂netim Paneli</h2>
        <button onclick="cikisYap()" class="btn btn-danger">√áƒ±kƒ±≈ü Yap</button>
    </div>
    
    <div class="row">
        <div class="col-md-4">
            
            <div class="card shadow mb-4 border-info">
                <div class="card-header bg-info text-white">
                    <h6 class="m-0">üë§ Personel Ekle (Garson/Mutfak/Kasa)</h6>
                </div>
                <div class="card-body">
                    <label>Kullanƒ±cƒ± Adƒ±:</label>
                    <input type="text" id="personelAdi" class="form-control mb-2" placeholder="√ñrn: garson_ali">
                    
                    <label>≈ûifre:</label>
                    <input type="text" id="personelSifre" class="form-control mb-2" placeholder="√ñrn: 1234">
                    
                    <label>Rol√º:</label>
                    <select id="personelRol" class="form-select mb-3">
                        <option value="garson">Garson</option>
                        <option value="mutfak">Mutfak Personeli</option>
                        <option value="kasa">Kasiyer</option>
                        <option value="admin">Y√∂netici (Admin)</option>
                    </select>

                    <button onclick="personelEkle()" class="btn btn-info text-white w-100">Personeli Kaydet</button>
                </div>
            </div>

            <div class="card shadow mb-4">
                <div class="card-header bg-warning text-dark">
                    <h6 class="m-0">‚ûï Yeni Kategori Olu≈ütur</h6>
                </div>
                <div class="card-body">
                    <label>Kategori Adƒ±:</label>
                    <input type="text" id="kategoriAdi" class="form-control mb-2" placeholder="√ñrn: √áorbalar">
                    <button onclick="kategoriEkle()" class="btn btn-warning w-100">Kategori Ekle</button>
                </div>
            </div>

            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h6 class="m-0">üçî Yeni √úr√ºn Ekle</h6>
                </div>
                <div class="card-body">
                    <label>√úr√ºn Adƒ±:</label>
                    <input type="text" id="urunAdi" class="form-control mb-2" placeholder="√ñrn: Mercimek √áorbasƒ±">
                    
                    <label>Fiyat (TL):</label>
                    <input type="number" id="urunFiyat" class="form-control mb-2" placeholder="0.00">
                    
                    <label>Kategori Se√ß:</label>
                    <select id="urunKategori" class="form-select mb-3">
                        <option selected disabled>Y√ºkleniyor...</option>
                    </select>

                    <button onclick="urunEkle()" class="btn btn-success w-100">√úr√ºn√º Kaydet</button>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                    <h5 class="m-0">üìã Mevcut Men√º</h5>
                    <button onclick="sayfayiYenile()" class="btn btn-sm btn-outline-light">Tabloyu Yenile</button>
                </div>
                <div class="card-body">
                    <table class="table table-hover table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>√úr√ºn Adƒ±</th>
                                <th>Fiyat</th>
                                <th>Kategori ID</th>
                            </tr>
                        </thead>
                        <tbody id="urunListesi">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- AYARLAR ---
    const BASE_URL = ""; 

    window.onload = function() {
        sayfayiYenile();
    };

    function sayfayiYenile() {
        kategorileriGetir();
        menuyuGetir();
    }
    
    function cikisYap() {
        localStorage.removeItem("access_token");
        window.location.href = 'login.html'; // D√úZELTƒ∞LDƒ∞
    }

    // --- 0. PERSONEL EKLEME ---
    async function personelEkle() {
        const token = localStorage.getItem("access_token");
        if (!token) { window.location.href = 'login.html'; return; } // D√úZELTƒ∞LDƒ∞

        const kadi = document.getElementById("personelAdi").value;
        const sifre = document.getElementById("personelSifre").value;
        const rol = document.getElementById("personelRol").value;

        if(!kadi || !sifre) { alert("L√ºtfen kullanƒ±cƒ± adƒ± ve ≈üifre girin!"); return; }

        try {
            const response = await fetch(`${BASE_URL}/users`, {
                method: 'POST',
                headers: { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: kadi, password: sifre, role: rol })
            });

            if (response.status === 403) { alert("Yetkiniz yok!"); return; }
            if (response.ok) {
                alert(`‚úÖ ${kadi} kullanƒ±cƒ±sƒ± olu≈üturuldu!`);
                document.getElementById("personelAdi").value = "";
                document.getElementById("personelSifre").value = "";
            } else { alert("Hata olu≈ütu!"); }
        } catch (error) { alert("Sunucu hatasƒ±: " + error.message); }
    }

    // --- 1. KATEGORƒ∞ Lƒ∞STELEME ---
    async function kategorileriGetir() {
        const token = localStorage.getItem("access_token");
        if (!token) { window.location.href = 'login.html'; return; } // D√úZELTƒ∞LDƒ∞

        try {
            const response = await fetch(`${BASE_URL}/categories`, {
                headers: { 'Authorization': 'Bearer ' + token }
            });
            if (response.status === 401) { cikisYap(); return; }

            const kategoriler = await response.json();
            const selectKutu = document.getElementById("urunKategori");
            selectKutu.innerHTML = ""; 
            if(kategoriler.length === 0) {
                selectKutu.innerHTML = "<option disabled selected>√ñnce Kategori Ekleyin!</option>";
            } else {
                kategoriler.forEach(kat => {
                    selectKutu.innerHTML += `<option value="${kat.id}">${kat.name}</option>`;
                });
            }
        } catch (error) { console.error(error); }
    }

    // --- 2. KATEGORƒ∞ EKLEME ---
    async function kategoriEkle() {
        const token = localStorage.getItem("access_token");
        if (!token) { window.location.href = 'login.html'; return; } // D√úZELTƒ∞LDƒ∞

        const ad = document.getElementById("kategoriAdi").value;
        if(!ad) return;

        try {
            const response = await fetch(`${BASE_URL}/categories`, {
                method: 'POST',
                headers: { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: ad })
            });
            if (response.ok) {
                alert("‚úÖ Kategori eklendi!");
                document.getElementById("kategoriAdi").value = "";
                sayfayiYenile(); 
            }
        } catch (error) { alert("Hata: " + error.message); }
    }

    // --- 3. √úR√úN Lƒ∞STELEME ---
    async function menuyuGetir() {
        const token = localStorage.getItem("access_token");
        if (!token) return;

        try {
            const response = await fetch(`${BASE_URL}/products`, {
                headers: { 'Authorization': 'Bearer ' + token }
            });
            const urunler = await response.json();
            const tablo = document.getElementById("urunListesi");
            tablo.innerHTML = ""; 
            urunler.forEach(urun => {
                tablo.innerHTML += `<tr><td><span class="badge bg-secondary">${urun.id}</span></td><td><b>${urun.name}</b></td><td>${urun.price} ‚Ç∫</td><td>${urun.category_id}</td></tr>`;
            });
        } catch (error) { console.error(error); }
    }

    // --- 4. √úR√úN EKLEME ---
    async function urunEkle() {
        const token = localStorage.getItem("access_token");
        if (!token) { window.location.href = 'login.html'; return; } // D√úZELTƒ∞LDƒ∞

        const ad = document.getElementById("urunAdi").value;
        const fiyat = document.getElementById("urunFiyat").value;
        const katId = document.getElementById("urunKategori").value;

        if(!ad || !fiyat || !katId) { alert("Bilgileri doldurun!"); return; }

        try {
            const response = await fetch(`${BASE_URL}/products`, {
                method: 'POST',
                headers: { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: ad, price: parseFloat(fiyat), category_id: parseInt(katId) })
            });
            if (response.ok) {
                alert("‚úÖ √úr√ºn eklendi!");
                sayfayiYenile();
            } else { alert("Hata olu≈ütu."); }
        } catch (error) { alert("Baƒülantƒ± hatasƒ±"); }
    }
</script>

</body>
</html>

