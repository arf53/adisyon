<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Giriş Yap</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light d-flex align-items-center justify-content-center" style="height: 100vh;">

<div class="card shadow p-4" style="width: 400px;">
    <h3 class="text-center mb-4">Restoran Girişi</h3>
    <input type="text" id="username" class="form-control mb-3" placeholder="Kullanıcı Adı">
    <input type="password" id="password" class="form-control mb-3" placeholder="Şifre">
    <button onclick="girisYap()" class="btn btn-primary w-100">Giriş Yap</button>
    <hr>
    <button onclick="window.location.href='register.html'" class="btn btn-success w-100">Yeni İşletme Kaydı</button>
</div>

<script>
    // --- AYARLAR ---

    async function girisYap() {
        const kadi = document.getElementById("username").value;
        const sifre = document.getElementById("password").value;

        const formData = new URLSearchParams();
        formData.append('username', kadi);
        formData.append('password', sifre);

        try {
            const response = await fetch(`/token`, {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: formData
            });

            if (response.ok) {
                const data = await response.json();
                
                // 1. Token'ı kaydet
                localStorage.setItem('access_token', data.access_token);
                
                // 2. ROL KONTROLÜ VE YÖNLENDİRME
                const userRole = data.role; 

                // --- DÜZELTME 2: Yönlendirmelerden '/static/' silindi ---
                if (userRole === 'admin') {
                    window.location.href = 'admin.html'; // Sadece dosya adı
                } 
                else if (userRole === 'garson') {
                    window.location.href = 'garson.html';
                }
                else if (userRole === 'mutfak') {
                    window.location.href = 'mutfak.html';
                }
                else if (userRole === 'kasa') {
                    window.location.href = 'kasa.html';
                }
                else {
                    alert("Rolünüz tanımlı değil!");
                }

            } else {
                alert("Hatalı kullanıcı adı veya şifre!");
            }
        } catch (error) {
            console.error(error);
            alert("Sunucuya bağlanılamadı.");
        }
    }
</script>
</body>

</html>

