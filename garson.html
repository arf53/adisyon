Harika bir fikir! Sipariş notu eklemek, özellikle mutfak ekibiyle iletişim kurmak (örneğin: "Tuzsuz olsun", "Az pişmiş") için çok kritiktir. Mevcut kodunda zaten bir note alanı tanımlıydı; şimdi bunu sadece görünür ve düzenlenebilir hale getireceğiz.

Aşağıda, garson.html dosyanın içindeki <script> bölümünü tamamen yeniledim. Bu yeni sürümde sepete eklenen her ürünün altında bir "Not Ekle" kutusu çıkacak.

✅ Güncellenmiş Garson Ekranı Kodları
Bu kodu, garson.html içindeki mevcut <script> ... </script> bloğunun tamamıyla değiştir:

JavaScript
<script>
    // ÖNEMLİ: Daha önceki hatayı düzelterek BASE_URL tanımladım
    const BASE_URL = ""; 
    let sepet = [];
    let urunlerDB = [];

    window.onload = function() {
        const token = localStorage.getItem("access_token");
        if (!token) { window.location.href = 'login.html'; return; }
        urunleriGetir();
    };

    async function urunleriGetir() {
        const token = localStorage.getItem("access_token");
        try {
            const response = await fetch(`/products`, {
                headers: { 'Authorization': 'Bearer ' + token }
            });
            if (response.status === 401) { window.location.href = 'login.html'; return; }
            
            urunlerDB = await response.json();
            const alan = document.getElementById("urunListesi");
            alan.innerHTML = "";
            urunlerDB.forEach(urun => {
                alan.innerHTML += `
                    <div class="col-md-4 mb-3">
                        <div class="card urun-kutusu shadow-sm text-center bg-white" onclick="sepeteEkle(${urun.id})">
                            <div class="card-body d-flex flex-column justify-content-center">
                                <h5 class="card-title">${urun.name}</h5>
                                <p class="card-text text-primary fw-bold">${urun.price} TL</p>
                            </div>
                        </div>
                    </div>`;
            });
        } catch (error) { console.error("Hata:", error); }
    }

    function sepeteEkle(urunID) {
        const urun = urunlerDB.find(u => u.id === urunID);
        const varMi = sepet.find(item => item.product_id === urunID);
        
        if (varMi) { 
            varMi.quantity += 1; 
        } else { 
            // Her ürün için boş bir note alanı ile ekliyoruz
            sepet.push({ 
                product_id: urun.id, 
                name: urun.name, 
                price: urun.price, 
                quantity: 1, 
                note: "" 
            }); 
        }
        sepetiGuncelle();
    }

    // --- YENİ: NOTU GÜNCELLEME FONKSİYONU ---
    function notuGuncelle(index, yeniNot) {
        sepet[index].note = yeniNot;
    }

    function sepetiGuncelle() {
        const liste = document.getElementById("sepetListesi");
        const toplamEl = document.getElementById("toplamFiyat");
        liste.innerHTML = "";
        let toplam = 0;

        sepet.forEach((item, index) => {
            toplam += item.price * item.quantity;
            liste.innerHTML += `
                <div class="card mb-2 shadow-sm border-0 bg-white">
                    <div class="card-body p-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${item.name}</strong><br>
                                <small class="text-muted">${item.quantity} x ${item.price} TL</small>
                            </div>
                            <div class="text-end">
                                <span class="fw-bold">${(item.price * item.quantity).toFixed(2)} TL</span>
                                <button onclick="sepettenSil(${index})" class="btn btn-sm btn-outline-danger ms-2">X</button>
                            </div>
                        </div>
                        <div class="mt-2">
                            <input type="text" class="form-control form-control-sm" 
                                   placeholder="Sipariş notu ekle..." 
                                   value="${item.note}" 
                                   oninput="notuGuncelle(${index}, this.value)">
                        </div>
                    </div>
                </div>`;
        });
        toplamEl.innerText = toplam.toFixed(2) + " TL";
    }

    function sepettenSil(index) { sepet.splice(index, 1); sepetiGuncelle(); }

    async function siparisiGonder() {
        if (sepet.length === 0) { alert("Sepet boş!"); return; }
        const token = localStorage.getItem("access_token");
        const masaNo = document.getElementById("masaNo").value;
        
        try {
            const response = await fetch(`/orders`, {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json', 
                    'Authorization': 'Bearer ' + token 
                },
                body: JSON.stringify({ 
                    table_no: parseInt(masaNo), 
                    // sepet içindeki güncel notlar burada API'ye gönderiliyor
                    items: sepet.map(item => ({ 
                        product_id: item.product_id, 
                        quantity: item.quantity, 
                        note: item.note 
                    })) 
                })
            });
            if (response.ok) { 
                alert("Sipariş Mutfak Ekranına Düştü! ✅"); 
                sepet = []; 
                sepetiGuncelle(); 
            } else {
                alert("Sipariş gönderilemedi, oturumunuz dolmuş olabilir.");
            }
        } catch (hata) { 
            console.error(hata); 
            alert("Bağlantı hatası oluştu!");
        }
    }
</script>



